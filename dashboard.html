<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Acessível - Portaria DataWake</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.0/build/qrcode.min.js"></script>
    <style>
        :root {
            --primary: #fcb713;
            --primary-hover: #ffd84e;
            --bg: #0c0c10;
            --card: #1a1a22;
            --text: #fff;
            --text-light: #bbb;
            --success: #4CAF50;
            --border: #333;
            --focus: #ffd84e;
        }

        [data-theme="high-contrast"] {
            --bg: #000; --card: #111; --text: #fff; --text-light: #ff0;
            --primary: #ff0; --border: #ff0; --success: #0f0; --focus: #ff0;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background: var(--bg); color: var(--text); font-family: 'Poppins', sans-serif; line-height: 1.6; }
        .sr-only { position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0,0,0,0); white-space: nowrap; border: 0; }

        /* FOCO VISÍVEL */
        button:focus, input:focus, a:focus, [tabindex]:focus {
            outline: 3px solid var(--focus);
            outline-offset: 2px;
        }

        header {
            background: linear-gradient(90deg, #0b0b0e 0%, #1a1a22 100%);
            border-bottom: 3px solid var(--primary);
            padding: 18px 5%;
            display: flex; justify-content: space-between; align-items: center;
            position: sticky; top: 0; z-index: 100;
            box-shadow: 0 4px 20px rgba(252, 183, 19, 0.15);
        }

        .logo img { width: 140px; }
        .user-info { display: flex; align-items: center; gap: 12px; font-size: 0.95rem; }
        .user-avatar { width: 38px; height: 38px; background: var(--primary); color: #0c0c10; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700; }

        button {
            background: transparent; border: 2px solid var(--primary); color: var(--primary);
            padding: 10px 18px; border-radius: 8px; cursor: pointer; font-weight: 600;
            font-size: 0.95rem; transition: all 0.3s; display: flex; align-items: center; gap: 8px;
        }
        button:hover, button:focus { background: var(--primary); color: #0c0c10; }

        main { padding: 40px 5%; max-width: 1400px; margin: 0 auto; }
        h1 { text-align: center; font-size: 2.5rem; margin-bottom: 30px; color: var(--primary); }

        .dashboard-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 40px; }
        @media (max-width: 992px) { .dashboard-grid { grid-template-columns: 1fr; } }

        .card {
            background: var(--card); border-radius: 16px; padding: 25px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.3); border: 1px solid var(--border);
        }
        .card h2 { color: var(--primary); margin-bottom: 20px; font-size: 1.5rem; display: flex; align-items: center; gap: 10px; }

        #relogio { font-size: 3rem; font-weight: 700; text-align: center; color: var(--primary); margin: 20px 0; }
        #data-atual { text-align: center; color: var(--text-light); }

        .calendar { display: grid; grid-template-columns: repeat(7, 1fr); gap: 8px; text-align: center; font-size: 0.9rem; }
        .calendar-header { grid-column: 1 / -1; display: grid; grid-template-columns: repeat(7, 1fr); font-weight: 600; color: var(--primary); margin-bottom: 10px; }
        .calendar-day { padding: 12px 8px; background: rgba(252, 183, 19, 0.1); border-radius: 8px; cursor: pointer; transition: all 0.3s; position: relative; }
        .calendar-day:hover, .calendar-day:focus { background: var(--primary); color: #0c0c10; }
        .calendar-day.today { background: var(--primary); color: #0c0c10; font-weight: 700; }
        .calendar-day.event::after { content: ''; width: 8px; height: 8px; background: var(--success); border-radius: 50%; position: absolute; bottom: 6px; left: 50%; transform: translateX(-50%); }

        .entrada-item { display: flex; align-items: center; gap: 15px; padding: 12px 0; border-bottom: 1px dashed var(--border); }
        .entrada-item:last-child { border-bottom: none; }
        .entrada-avatar { width: 40px; height: 40px; background: #333; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 600; color: var(--primary); }
        .entrada-hora { font-size: 0.8rem; color: var(--text-light); }

        .libras-container { position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden; border-radius: 12px; box-shadow: 0 8px 20px rgba(0,0,0,0.4); }
        .libras-container video { position: absolute; top: 0; left: 0; width: 100%; height: 100%; border-radius: 12px; }
        .libras-label { position: absolute; bottom: 10px; left: 10px; background: rgba(0,0,0,0.7); color: #fff; padding: 5px 10px; border-radius: 6px; font-size: 0.8rem; z-index: 2; }

        #qr-output { margin-top: 15px; text-align: center; }
        #qr-canvas { background: #fff; padding: 10px; border-radius: 8px; display: inline-block; }

        footer { text-align: center; padding: 30px; color: #666; font-size: 0.9rem; }
    </style>
</head>

<body>

    <header>
        <div class="logo">
            <img src="images/DTW.png" alt="Logo DataWake - Sistema de Portaria Acessível">
        </div>
        <nav style="display: flex; align-items: center; gap: 15px;">
            <div class="user-info" aria-label="Usuário logado">
                <div class="user-avatar" id="user-avatar" aria-hidden="true">U</div>
                <span id="user-email" aria-label="E-mail do usuário">carregando...</span>
            </div>
            <button id="toggle-contrast" aria-label="Alternar modo de alto contraste para acessibilidade">
                Alto Contraste
            </button>
            <button id="logout-btn" onclick="logout()" aria-label="Sair do sistema">
                Sair
            </button>
        </nav>
    </header>

    <main>
        <h1 id="dashboard-title">Dashboard da Portaria - Acessível</h1>

        <div class="dashboard-grid" aria-labelledby="dashboard-title">

            <!-- RELÓGIO + CALENDÁRIO -->
            <section class="card" aria-labelledby="secao-hoje">
                <h2 id="secao-hoje">
                    Hoje <span class="sr-only">- Relógio e calendário do mês atual</span>
                </h2>
                <div id="relogio" aria-live="polite" aria-atomic="true">00:00:00</div>
                <div id="data-atual" aria-label="Data completa"></div>

                <h3 style="margin:20px 0 15px; color:var(--primary);">Calendário do Mês</h3>
                <div class="calendar-header" role="row">
                    <div role="columnheader">Domingo</div>
                    <div role="columnheader">Segunda</div>
                    <div role="columnheader">Terça</div>
                    <div role="columnheader">Quarta</div>
                    <div role="columnheader">Quinta</div>
                    <div role="columnheader">Sexta</div>
                    <div role="columnheader">Sábado</div>
                </div>
                <div id="calendar-body" class="calendar" role="grid"></div>
            </section>

            <!-- REGISTRO DE VISITANTE -->
            <section class="card" aria-labelledby="secao-registro">
                <h2 id="secao-registro">
                    Registrar Visitante
                </h2>
                <label for="visitante-nome" class="sr-only">Nome completo do visitante</label>
                <input 
                    type="text" 
                    id="visitante-nome" 
                    placeholder="Digite o nome completo" 
                    aria-required="true"
                    style="width:100%; padding:12px; margin:10px 0; border-radius:8px; border:1px solid var(--border); background:#222; color:#fff; font-size:1rem;"
                >
                <button 
                    onclick="registrarVisitante()" 
                    style="width:100%; margin-top:10px;"
                    aria-label="Registrar visitante e gerar QR Code com foto"
                >
                    Registrar com QR Code
                </button>
                <div id="qr-output" aria-live="polite"></div>
            </section>

        </div>

        <!-- LIBRAS + ENTRADAS -->
        <section class="card" style="grid-column: 1 / -1; display: grid; grid-template-columns: 1fr 1fr; gap: 30px;" aria-labelledby="secao-libras-entradas">
            <div>
                <h2 id="secao-libras">Boas-vindas em Libras</h2>
                <div class="libras-container">
                    <video 
                        id="libras-video" 
                        autoplay 
                        loop 
                        muted 
                        playsinline 
                        controls 
                        poster="images/libras-poster.jpg"
                        aria-describedby="libras-desc"
                    >
                        <source src="videos/libras-boas-vindas.mp4" type="video/mp4">
                        <track kind="captions" src="videos/libras-boas-vindas.vtt" srclang="pt" label="Legendas em Português" default>
                        <p>Seu navegador não suporta vídeo. <a href="videos/libras-boas-vindas.mp4">Baixe o vídeo</a>.</p>
                    </video>
                    <div class="libras-label" aria-hidden="true">LIBRAS ATIVA</div>
                </div>
                <p id="libras-desc" class="sr-only">
                    Vídeo em Libras com intérprete sinalizando: "Bem-vindo ao sistema de portaria acessível da DataWake. 
                    Use o dashboard para ver o horário, calendário, registrar visitantes e ver as últimas entradas. 
                    O sistema tem alto contraste, navegação por teclado e é compatível com leitores de tela."
                </p>
                <p style="margin-top:15px; font-size:0.9rem; color:var(--text-light);">
                    Vídeo com legendas e controles acessíveis.
                </p>
            </div>

            <div>
                <h2 id="secao-entradas">Últimas Entradas</h2>
                <div id="entradas-lista" aria-live="polite">
                    <p style="text-align:center; color:#888; margin-top:20px;">Nenhuma entrada registrada hoje.</p>
                </div>
            </div>
        </section>
    </main>

    <footer>
        <p>© 2025 DataWake - Sistema de Portaria 100% Acessível</p>
    </footer>

    <script src="script.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const email = usuarioLogado();
            if (email) {
                const avatar = document.getElementById("user-avatar");
                const emailSpan = document.getElementById("user-email");
                avatar.textContent = email[0].toUpperCase();
                emailSpan.textContent = email;
                emailSpan.setAttribute("aria-label", `Usuário logado: ${email}`);
            }

            // RELÓGIO COM ARIA-LIVE
            function atualizarRelogio() {
                const agora = new Date();
                const h = String(agora.getHours()).padStart(2, '0');
                const m = String(agora.getMinutes()).padStart(2, '0');
                const s = String(agora.getSeconds()).padStart(2, '0');
                const relogio = document.getElementById("relogio");
                relogio.textContent = `${h}:${m}:${s}`;
                relogio.setAttribute("aria-label", `Horário atual: ${h} horas, ${m} minutos e ${s} segundos`);

                const data = agora.toLocaleDateString('pt-BR', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
                document.getElementById("data-atual").textContent = data;
            }
            atualizarRelogio();
            setInterval(atualizarRelogio, 1000);

            // CALENDÁRIO ACESSÍVEL
            function gerarCalendario() {
                const hoje = new Date();
                const ano = hoje.getFullYear();
                const mes = hoje.getMonth();
                const primeiroDia = new Date(ano, mes, 1).getDay();
                const diasNoMes = new Date(ano, mes + 1, 0).getDate();
                const diaHoje = hoje.getDate();

                const body = document.getElementById("calendar-body");
                body.innerHTML = '';

                for (let i = 0; i < primeiroDia; i++) {
                    body.innerHTML += `<div role="gridcell"></div>`;
                }
                for (let dia = 1; dia <= diasNoMes; dia++) {
                    const isHoje = dia === diaHoje;
                    const hasEvento = [10, 15, 20, 25].includes(dia);
                    const cls = isHoje ? 'calendar-day today' : 'calendar-day';
                    const evt = hasEvento ? ' event' : '';
                    const aria = hasEvento ? `aria-label="Dia ${dia} com evento"` : `aria-label="Dia ${dia}"`;
                    body.innerHTML += `
                        <div role="gridcell" class="${cls}${evt}" ${aria} tabindex="0" onclick="mostrarEvento(${dia})" onkeydown="if(event.key==='Enter') mostrarEvento(${dia})">
                            ${dia}
                        </div>`;
                }
            }
            gerarCalendario();

            // REGISTRAR VISITANTE
            window.registrarVisitante = function() {
                const nomeInput = document.getElementById("visitante-nome");
                const nome = nomeInput.value.trim();
                if (!nome) {
                    mostrarAlerta(document.body, "Por favor, digite o nome do visitante.", "var(--danger)");
                    nomeInput.focus();
                    return;
                }

                const hora = new Date().toLocaleTimeString('pt-BR', {hour: '2-digit', minute: '2-digit'});
                const data = { nome, hora, email: usuarioLogado() };
                let entradas = JSON.parse(localStorage.getItem("entradas") || "[]");
                entradas.unshift(data);
                localStorage.setItem("entradas", JSON.stringify(entradas.slice(0, 10)));

                // QR Code com texto alternativo
                const qrDiv = document.getElementById("qr-output");
                qrDiv.innerHTML = `
                    <canvas id="qr-canvas"></canvas>
                    <p id="qr-text" class="sr-only">QR Code para ${nome}, entrada às ${hora}. Escaneie com o celular.</p>
                    <p>QR gerado para <strong>${nome}</strong> às ${hora}</p>
                `;
                QRCode.toCanvas(document.getElementById("qr-canvas"), JSON.stringify(data), { width: 200 });

                atualizarEntradas();
                nomeInput.value = "";
                nomeInput.focus();
            };

            // ATUALIZAR ENTRADAS
            function atualizarEntradas() {
                const entradas = JSON.parse(localStorage.getItem("entradas") || "[]");
                const lista = document.getElementById("entradas-lista");
                if (entradas.length === 0) {
                    lista.innerHTML = `<p style="text-align:center; color:#888;">Nenhuma entrada registrada hoje.</p>`;
                    return;
                }
                lista.innerHTML = entradas.map((e, i) => `
                    <div class="entrada-item" role="row" aria-label="Entrada ${i+1}: ${e.nome} às ${e.hora}">
                        <div class="entrada-avatar" aria-hidden="true">${e.nome[0]}</div>
                        <div class="entrada-info">
                            <div><strong>${e.nome}</strong></div>
                            <div class="entrada-hora">${e.hora}</div>
                        </div>
                    </div>
                `).join('');
            }
            atualizarEntradas();

            // EVENTO DO DIA
            window.mostrarEvento = function(dia) {
                const mensagem = `Evento no dia ${dia} de abril: Reunião mensal da equipe de portaria.`;
                alert(mensagem);
                const live = document.createElement("div");
                live.setAttribute("aria-live", "polite");
                live.className = "sr-only";
                live.textContent = mensagem;
                document.body.appendChild(live);
                setTimeout(() => document.body.removeChild(live), 100);
            };

            // ALTO CONTRASTE
            const toggleBtn = document.getElementById("toggle-contrast");
            toggleBtn.addEventListener("click", () => {
                const isHigh = document.body.getAttribute("data-theme") === "high-contrast";
                const novoTema = isHigh ? "" : "high-contrast";
                document.body.setAttribute("data-theme", novoTema);
                localStorage.setItem("theme", isHigh ? "normal" : "high-contrast");
                toggleBtn.setAttribute("aria-label", isHigh ? "Ativar modo de alto contraste" : "Desativar modo de alto contraste");
            });

            if (localStorage.getItem("theme") === "high-contrast") {
                document.body.setAttribute("data-theme", "high-contrast");
            }
        });
    </script>
</body>

</html>